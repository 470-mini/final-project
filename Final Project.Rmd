---
title: "Final Project"
author: "Entong Li, Jingyu Xie, Xindi Lu, Zijia Cao"
date: "12/1/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, autodep = TRUE)
library(tidyverse)
library(MASS)
library(broom)
library(GGally)
google <- read.csv("data/googleplaystore.csv", header = TRUE)
google <- na.omit(google)
google <- google[-c(11,12,13)] %>% filter(0<= Rating, 5>= Rating)
```


```{r}
#Make Price as numeric variable:
google$Price <- recode_factor(google$Price, `0` = "$0", `Everyone` = "$0")
Price2 <- as.numeric(gsub("\\$","",google$Price))
google$Price <- Price2
google$ForP <- ifelse(google$Price == 0, "Free","Paid")
```

```{r}
#recode the levels of Installs:
google$Installs <- factor(google$Installs, levels = c("1+","5+","10+", "50+", "100+", "500+", "1,000+", "5,000+", "10,000+", "50,000+", "100,000+", "500,000+", "1,000,000+", "5,000,000+", "10,000,000+", "50,000,000+", "100,000,000+", "500,000,000+", "1,000,000,000+" ))
```

```{r}
#Make Reviews as numeric variables:
Reviews2 <- as.numeric(as.character(google$Reviews))
google$Reviews <- Reviews2
```

```{r}
#Divede Size into two groups: Mbs and kbs, and make the Size become a numeric variable:
google <- google %>% filter(Size != "Varies with device", Size != "1,000+")
google$Size <- as.character(google$Size)
google$Size.M <- ifelse(grepl("M", google$Size), "M","k")
Size1 <- as.numeric(gsub("[k|M]","",google$Size))
google$Size <- Size1
```

```{r}
google$Category <- as.character(google$Category)
google.part <- google %>% filter(google$Category %in% c("FAMILY","GAME","TOOLS","HEALTH_AND_FITNESS","SPORTS","SOCIAL", "COMMUNICATION","DATING"), Price <= 10)
google.part$Category <- as.factor(recode(google.part$Category, "HEALTH_AND_FITNESS" = "FITNESS","SPORTS" = "FITNESS","SOCIAL" = "MEDIA", "COMMUNICATION" = "MEDIA","DATING" = "MEDIA"))
```

## Free vs Paid:

```{r}
ggplot(google.part, aes(x = ForP, group = Category, color = Category,fill = Category)) + geom_bar()
```

## Size: Mbs vs. Kbs:

```{r}
ggplot(data = google.part, aes(x = Size.M, group = Category, color = Category, fill = Category)) + geom_bar()
google.part <- google.part %>% filter(google.part$Size.M == "M")
```

As the number of apps that size are counted by kbs is pretty small, we will include the apps that size are counted by Mbs. 

## Rating explanatory:

```{r}
ggpairs(google.part[c(2,3,5,8)])
```

### Rating and Free or Paid:

```{r}
ggplot(data = google.part, aes(x = Rating,..count.., fill = Type )) + geom_density(position = "fill") + labs(title = "Density of rating based on type")
ggplot(data = google.part, aes(x = Rating,..count.., fill = Category )) + geom_density(position = "fill") + labs(fill = "Category") + labs(title = "Density of rating based on category")
ggplot(data = google.part, aes(x = Rating, color = Category,fill = Category))+ geom_bar()
```

```{r}
google.part <- google.part%>%filter(Size <= 100)
ggplot(data = google.part, aes(x = Size, y = Rating, color = Category)) + geom_point() + geom_smooth(method = 'lm',se = FALSE,color = "black") + facet_wrap(~Category)
```

```{r}
glm(weights = Reviews, Rating ~ Price + Size + Category, data = google.part)
```

```{r}
rlm(Rating~Price + Size + Category, weights = Reviews, data = google.part, psi = psi.bisquare)
```

